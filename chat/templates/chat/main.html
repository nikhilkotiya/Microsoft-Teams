<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="{% static 'main.css' %}">

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk" crossorigin="anonymous">

  <style>
    .video-grid-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      background-color: black;
    }

    .main-grid-container {
      display: grid;
      grid-template-columns: 60% 20%;
    }

    video {
      /* border-radius: 25%;
            background-color: black; */
      margin: 100px;
    }

    .main-grid-container {
      display: flex;
      flex-direction: column;
    }
  </style>
</head>

<body>
  <div class="head2" style="background-color: rgb(73, 72, 72);position: relative;top:0px;">

    <input type="hidden" name="smname" id="smname" />
    <div style="position:absolute;right:0px"><a href="/home"><button style="padding: 8px 25px ;border-radius: 40px;margin: 6px;">Go Home</button></a></div>
    <div>
      <button id="btn-join" style="padding: 8px 25px ;border-radius: 40px;margin: 6px ;"> Join Room </button>
    </div>
    <div class="share-button">
      <span><i class="fas fa-share-alt"> Share</i></span>
      <a href="whatsapp://send?text=You're invited to a Teams meeting!- http://127.0.0.1:8000/" data-action="share/whatsapp/share"><i class="fab fa-whatsapp"></i></a>
      <a href="mailto:?subject=Teams meeting &body=You're invited to a Teams meeting!- http://127.0.0.1:8000/"><i class="fas fa-envelope"></i></a>
    </div>

    
    <div class="main-grid-container" style="background-color: black;">
      <div id="video-container" style="display:flex;flex-wrap:wrap;justify-content: space-evenly;">
        <div style="margin: 9px 0px 7px 0px;">
          <video id="local-video" style= "width:min-content ;height:60vh;width:45vw;background-color: rgb(17, 16, 16);margin-top: 24px;" autoplay playsinline>
          </video>
          <div style="display: flexbox;justify-content: center; text-align: center;background-color: rgb(247, 243, 243);">
            <div>
              <h3 id="label-username" type="hidden"></h3>
              <input id="username" type="hidden" value="{{request.user.email}}">
            </div>
            <button id="btn-toggle-audio" style="border-radius: 60px;margin-bottom: 8px;">Audio Mute</button>
            <button id="btn-toggle-video" style="border-radius: 50px;margin-bottom: 8px;">Video Off</button>
          </div>
        </div>
        <div id="chat" style="float:right; position:fixed; width: 21.5vw; bottom: 1%;right:0.3%; margin-top: 0; border: 4px solid rgb(52, 52, 53); background-color: rgb(102, 101, 101); ">
          <div class="chat_2">
            <h2 style="color:white; justify-content: center;text-align: center; ">
            </h2>
            <ul id="menu">User Online</ul>
            <hr style="color:white;">
          </div>
          <hr style="color:white;">
          <div id="messages">
            <ul id="message-list" style="color:white; min-width:200px; word-wrap:break-word;"></ul>

          </div>
          <div class="send_2">
            <input id="msg" style="border: 3px solid rgba(107, 70, 70, 0.925);" required><button onclick="scrollWin(0, 50)" required id="btn-send-msg">Send Messages</button>
          </div>
        </div>
      </div>
    </div>

    <div class="voice_r">
        <button onclick="myFunction()"><i class="fas fa-microphone fa-2x"></i></button>
    </div>

    <div class="container" style="border: 4px solid rgb(52, 52, 53);" id="myDIV">

      <div class="app">

        <div class="input-single">
          <textarea id="note-textarea" placeholder="Create a new note by typing or using voice recognition." rows="6"></textarea>
        </div>
        <button id="start-record-btn" title="Start Recording">Start</button>
        <button id="pause-record-btn" title="Pause Recording">Stop</button>
        <button id="save-note-btn" title="Save Note">Save</button>
              <p id="recording-instructions">Press the <strong>Start</strong> button</p>

        <h3>Saved</h3>
        <ul id="notes">
          <li>
            <p class="no-notes">None</p>
          </li>
        </ul>

      </div>

    </div>
  </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script type="text/javascript" src="{% static 'js/main.js' %}"></script>
  <!-- <script type="text/javascript" src="{% static 'js/jquery.js' %}"></script> -->

  <script type="text/javascript">
    function myFunction() {
      var x = document.getElementById("myDIV");
      if (x.style.display === "none") {
        x.style.display = "block";
      } else {
        x.style.display = "none";
      }
    }

    function updateScroll(){
      var element = document.getElementById("messages");
      element.scrollTop = element.scrollHeight;
    }
  </script>

<script>
  try {
    var SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    var recognition = new SpeechRecognition();
  } catch (e) {
    console.error(e);
    $('.no-browser-support').show();
    $('.app').hide();
  }
  
  
  var noteTextarea = $('#note-textarea');
  var instructions = $('#recording-instructions');
  var notesList = $('ul#notes');
  
  var noteContent = '';
  
  // Get all notes from previous sessions and display them.
  var notes = getAllNotes();
  renderNotes(notes);
  
  
  
  
  recognition.continuous = true;
  
  recognition.onresult = function(event) {
    var current = event.resultIndex;
  
    var transcript = event.results[current][0].transcript;
  
  
    var mobileRepeatBug = (current == 1 && transcript == event.results[0][0].transcript);
  
    if (!mobileRepeatBug) {
      noteContent += transcript;
      noteTextarea.val(noteContent);
    }
  };
  
  recognition.onstart = function() {
    instructions.text('Voice recognition activated. Try speaking into the microphone.');
  }
  
  recognition.onspeechend = function() {
    instructions.text('You were quiet for a while so voice recognition turned itself off.');
  }
  
  recognition.onerror = function(event) {
    if (event.error == 'no-speech') {
      instructions.text('No speech was detected. Try again.');
    };
  }
  
  
  
  /*-----------------------------
        App buttons and input
  ------------------------------*/
  
  $('#start-record-btn').on('click', function(e) {
    if (noteContent.length) {
      noteContent += ' ';
    }
    recognition.start();
  });
  
  
  $('#pause-record-btn').on('click', function(e) {
    recognition.stop();
    instructions.text('Voice recognition paused.');
  });
  
  // Sync the text inside the text area with the noteContent variable.
  noteTextarea.on('input', function() {
    noteContent = $(this).val();
  })
  
  $('#save-note-btn').on('click', function(e) {
    recognition.stop();
  
    if (!noteContent.length) {
      instructions.text('Could not save empty note. Please add a message to your note.');
    } else {
      // Save note to localStorage.
      // The key is the dateTime with seconds, the value is the content of the note.
      saveNote(new Date().toLocaleString(), noteContent);
  
      // Reset variables and update UI.
      noteContent = '';
      renderNotes(getAllNotes());
      noteTextarea.val('');
      instructions.text('Note saved successfully.');
    }
  
  })
  
  
  notesList.on('click', function(e) {
    e.preventDefault();
    var target = $(e.target);
  
    // Listen to the selected note.
    if (target.hasClass('listen-note')) {
      var content = target.closest('.note').find('.content').text();
      readOutLoud(content);
    }
  
    // Delete note.
    if (target.hasClass('delete-note')) {
      var dateTime = target.siblings('.date').text();
      deleteNote(dateTime);
      target.closest('.note').remove();
    }
  });
  
  
  
  /*-----------------------------
        Speech Synthesis
  ------------------------------*/
  
  function readOutLoud(message) {
    var speech = new SpeechSynthesisUtterance();
  
    // Set the text and voice attributes.
    speech.text = message;
    speech.volume = 1;
    speech.rate = 1;
    speech.pitch = 1;
  
    window.speechSynthesis.speak(speech);
  }
  
  
  
  /*-----------------------------
        Helper Functions
  ------------------------------*/
  
  function renderNotes(notes) {
    var html = '';
    if (notes.length) {
      notes.forEach(function(note) {
        html += `<li class="note">
          <p class="header">
            <span class="date">${note.date}</span>
            <a href="#" class="listen-note" title="Listen to Note">Listen to Note</a>
            <a href="#" class="delete-note" title="Delete">Delete</a>
          </p>
          <p class="content">${note.content}</p>
        </li>`;
      });
    } else {
      html = '<li><p class="content">You don\'t have any notes yet.</p></li>';
    }
    notesList.html(html);
  }
  
  
  function saveNote(dateTime, content) {
    localStorage.setItem('note-' + dateTime, content);
  }
  
  
  function getAllNotes() {
    var notes = [];
    var key;
    for (var i = 0; i < localStorage.length; i++) {
      key = localStorage.key(i);
      console.log(i)
      console.log(key)
  
      if (key.substring(0, 5) == 'note-') {
        notes.push({
          date: key.replace('note-', ''),
          content: localStorage.getItem(localStorage.key(i))
        });
      }
    }
    console.log(notes)
    return notes;
  }
  
  
  function deleteNote(dateTime) {
    localStorage.removeItem('note-' + dateTime);
  }
  

</script>

</body>

</html>
